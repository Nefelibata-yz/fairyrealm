(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{7936:function(e,t,a){Promise.resolve().then(a.bind(a,1403))},1403:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return c}});var s=a(7573),n=a(7653);let r="http://localhost:8787";function c(){let[e,t]=(0,n.useState)([]),[a,c]=(0,n.useState)(""),[i,o]=(0,n.useState)([]),[l,d]=(0,n.useState)(""),[h,u]=(0,n.useState)(!1),[b,m]=(0,n.useState)(void 0),[j]=(0,n.useState)("user-demo-"+Math.random().toString(36).substring(7));(0,n.useEffect)(()=>{fetch("".concat(r,"/api/books")).then(e=>e.json()).then(e=>{console.log("Fetched books:",e),Array.isArray(e)&&(t(e),e.length>0&&c(e[0].id))}).catch(e=>console.error("Failed to fetch books:",e))},[]);let f=async()=>{if(!l.trim()||h)return;let e={role:"user",content:l};o(t=>[...t,e]),d(""),u(!0);try{let t=await fetch("".concat(r,"/api/chat"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:j,bookId:a,message:e.content,conversationId:b})});if(!t.ok)throw Error("API Error");let s=await t.json();m(s.conversationId);let n={role:"assistant",content:s.reply,feedback:s.feedback,requireRewrite:s.requireRewrite};o(e=>[...e,n])}catch(e){console.error(e),o(e=>[...e,{role:"system",content:"Error connecting to teacher."}])}finally{u(!1)}};return(0,s.jsxs)("main",{className:"container",children:[(0,s.jsxs)("header",{children:[(0,s.jsx)("h1",{children:"FairyRealm \uD83E\uDDDA"}),(0,s.jsxs)("div",{className:"book-selector",children:[(0,s.jsx)("label",{children:"Choose a Book: "}),(0,s.jsx)("select",{value:a,onChange:e=>c(e.target.value),children:e.length>0?e.map(e=>(0,s.jsx)("option",{value:e.id,children:e.title},e.id)):(0,s.jsx)("option",{children:"Loading books..."})})]})]}),(0,s.jsxs)("div",{className:"chat-window",children:[i.map((e,t)=>(0,s.jsxs)("div",{className:"message ".concat(e.role),children:[(0,s.jsx)("div",{className:"bubble",children:e.content}),e.feedback&&(0,s.jsxs)("div",{className:"feedback-card",children:[(0,s.jsx)("h4",{children:"Teacher's Feedback:"}),e.feedback.grammar&&(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Grammar:"})," ",e.feedback.grammar]}),e.feedback.vocabulary&&(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Vocabulary:"})," ",e.feedback.vocabulary]}),(0,s.jsx)("p",{children:(0,s.jsx)("em",{children:e.feedback.encouragement})}),e.requireRewrite&&(0,s.jsx)("div",{className:"badge-retry",children:"Please rewrite this! ✍️"})]})]},t)),h&&(0,s.jsx)("div",{className:"message assistant",children:(0,s.jsx)("div",{className:"bubble",children:"Thinking..."})})]}),(0,s.jsxs)("div",{className:"input-area",children:[(0,s.jsx)("input",{type:"text",value:l,onChange:e=>d(e.target.value),onKeyDown:e=>"Enter"===e.key&&f(),placeholder:"Type your answer in English..."}),(0,s.jsx)("button",{onClick:f,disabled:h,children:"Send"})]})]})}}},function(e){e.O(0,[293,528,744],function(){return e(e.s=7936)}),_N_E=e.O()}]);