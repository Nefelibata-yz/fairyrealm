(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{7936:function(e,t,r){Promise.resolve().then(r.bind(r,1403))},1403:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return i}});var n=r(7573),o=r(7653);let s=r(4859).env.NEXT_PUBLIC_API_URL||"http://localhost:8787";function i(){let[e,t]=(0,o.useState)([]),[r,i]=(0,o.useState)(""),[a,c]=(0,o.useState)([]),[l,u]=(0,o.useState)(""),[d,h]=(0,o.useState)(!1),[f,m]=(0,o.useState)(void 0),[p]=(0,o.useState)("user-demo-"+Math.random().toString(36).substring(7));(0,o.useEffect)(()=>{fetch("".concat(s,"/api/books")).then(e=>e.json()).then(e=>{console.log("Fetched books:",e),Array.isArray(e)&&(t(e),e.length>0&&i(e[0].id))}).catch(e=>console.error("Failed to fetch books:",e))},[]);let v=async()=>{if(!l.trim()||d)return;let e={role:"user",content:l};c(t=>[...t,e]),u(""),h(!0);try{let t=await fetch("".concat(s,"/api/chat"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:p,bookId:r,message:e.content,conversationId:f})});if(!t.ok)throw Error("API Error");let n=await t.json();m(n.conversationId);let o={role:"assistant",content:n.reply,feedback:n.feedback,requireRewrite:n.requireRewrite};c(e=>[...e,o])}catch(e){console.error(e),c(e=>[...e,{role:"system",content:"Error connecting to teacher."}])}finally{h(!1)}};return(0,n.jsxs)("main",{className:"container",children:[(0,n.jsxs)("header",{children:[(0,n.jsx)("h1",{children:"FairyRealm \uD83E\uDDDA"}),(0,n.jsxs)("div",{className:"book-selector",children:[(0,n.jsx)("label",{children:"Choose a Book: "}),(0,n.jsx)("select",{value:r,onChange:e=>i(e.target.value),children:e.length>0?e.map(e=>(0,n.jsx)("option",{value:e.id,children:e.title},e.id)):(0,n.jsx)("option",{children:"Loading books..."})})]})]}),(0,n.jsxs)("div",{className:"chat-window",children:[a.map((e,t)=>(0,n.jsxs)("div",{className:"message ".concat(e.role),children:[(0,n.jsx)("div",{className:"bubble",children:e.content}),e.feedback&&(0,n.jsxs)("div",{className:"feedback-card",children:[(0,n.jsx)("h4",{children:"Teacher's Feedback:"}),e.feedback.grammar&&(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"Grammar:"})," ",e.feedback.grammar]}),e.feedback.vocabulary&&(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"Vocabulary:"})," ",e.feedback.vocabulary]}),(0,n.jsx)("p",{children:(0,n.jsx)("em",{children:e.feedback.encouragement})}),e.requireRewrite&&(0,n.jsx)("div",{className:"badge-retry",children:"Please rewrite this! ✍️"})]})]},t)),d&&(0,n.jsx)("div",{className:"message assistant",children:(0,n.jsx)("div",{className:"bubble",children:"Thinking..."})})]}),(0,n.jsxs)("div",{className:"input-area",children:[(0,n.jsx)("input",{type:"text",value:l,onChange:e=>u(e.target.value),onKeyDown:e=>"Enter"===e.key&&v(),placeholder:"Type your answer in English..."}),(0,n.jsx)("button",{onClick:v,disabled:d,children:"Send"})]})]})}},4859:function(e,t,r){"use strict";var n,o;e.exports=(null==(n=r.g.process)?void 0:n.env)&&"object"==typeof(null==(o=r.g.process)?void 0:o.env)?r.g.process:r(9566)},9566:function(e){!function(){var t={229:function(e){var t,r,n,o=e.exports={};function s(){throw Error("setTimeout has not been defined")}function i(){throw Error("clearTimeout has not been defined")}function a(e){if(t===setTimeout)return setTimeout(e,0);if((t===s||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(r){try{return t.call(null,e,0)}catch(r){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:s}catch(e){t=s}try{r="function"==typeof clearTimeout?clearTimeout:i}catch(e){r=i}}();var c=[],l=!1,u=-1;function d(){l&&n&&(l=!1,n.length?c=n.concat(c):u=-1,c.length&&h())}function h(){if(!l){var e=a(d);l=!0;for(var t=c.length;t;){for(n=c,c=[];++u<t;)n&&n[u].run();u=-1,t=c.length}n=null,l=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===i||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function m(){}o.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];c.push(new f(e,t)),1!==c.length||l||a(h)},f.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=m,o.addListener=m,o.once=m,o.off=m,o.removeListener=m,o.removeAllListeners=m,o.emit=m,o.prependListener=m,o.prependOnceListener=m,o.listeners=function(e){return[]},o.binding=function(e){throw Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw Error("process.chdir is not supported")},o.umask=function(){return 0}}},r={};function n(e){var o=r[e];if(void 0!==o)return o.exports;var s=r[e]={exports:{}},i=!0;try{t[e](s,s.exports,n),i=!1}finally{i&&delete r[e]}return s.exports}n.ab="//";var o=n(229);e.exports=o}()}},function(e){e.O(0,[293,528,744],function(){return e(e.s=7936)}),_N_E=e.O()}]);